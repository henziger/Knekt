function updateTextNGgramTables(a){var c={label:"Bigram",numType:"Count"},b={label:"Trigram",numType:"Count"};appState.fileIsSelected()?(c.ngrams=getNGramCount(a,2,10),b.ngrams=getNGramCount(a,3,10)):(a=createEmptyContext(10),c.ngrams=a,b.ngrams=a);handlebarExec("#ngram-table-template","#text-bigram-table",c);handlebarExec("#ngram-table-template","#text-trigram-table",b)}
function plotLanguageNGramTables(a,c){handlebarExec("#ngram-table-template","#language-bigram-table",a);handlebarExec("#ngram-table-template","#language-trigram-table",c)}
function updateLanguageNGramTables(a){var c={ngrams:[{ngram:"EN",num:2.81},{ngram:"ER",num:2.51},{ngram:"DE",num:2.37},{ngram:"AR",num:2.02},{ngram:"AN",num:1.88},{ngram:"ET",num:1.65},{ngram:"IN",num:1.65},{ngram:"ST",num:1.42},{ngram:"TE",num:1.41},{ngram:"TT",num:1.36}],label:"Bigram",numType:"Frequency"},b={ngrams:[{ngram:"TH",num:3.88},{ngram:"HE",num:3.68},{ngram:"IN",num:2.28},{ngram:"ER",num:2.18},{ngram:"AN",num:2.14},{ngram:"RE",num:1.75},{ngram:"ND",num:1.57},{ngram:"ON",num:1.42},{ngram:"EN",
num:1.38},{ngram:"AT",num:1.34}],label:"Bigram",numType:"Frequency"},d={ngrams:[{ngram:"F\u00d6R",num:1.05},{ngram:"ATT",num:.86},{ngram:"ING",num:.83},{ngram:"OCH",num:.82},{ngram:"TER",num:(.7).toFixed(2)},{ngram:"DET",num:.66},{ngram:"AND",num:.62},{ngram:"NDE",num:(.6).toFixed(2)},{ngram:"SOM",num:.58},{ngram:"DEN",num:.57}],label:"Trigram",numType:"Frequency"},e={ngrams:[{ngram:"THE",num:3.51},{ngram:"AND",num:1.59},{ngram:"ING",num:1.15},{ngram:"HER",num:.82},{ngram:"HAT",num:.65},{ngram:"HIS",
num:(.6).toFixed(2)},{ngram:"THA",num:.59},{ngram:"ERE",num:.56},{ngram:"FOR",num:.56},{ngram:"ENT",num:.53}],label:"Trigram",numType:"Frequency"};"sv"===a?plotLanguageNGramTables(c,d):"en"===a&&plotLanguageNGramTables(b,e)}
function initNGramTablesMngr(){document.body.addEventListener("languageChange",function(a){updateLanguageNGramTables(a.detail)});document.body.addEventListener("fileChange",function(a){updateTextNGgramTables(a.detail)});updateLanguageNGramTables(appState.getLang());updateTextNGgramTables()};var initInterface=function(){createFileSelect();disableToolButtonBorder();initCustomScrollbars()},createFileSelect=function(){handlebarExec("#file-select-template","#file-section",{name:"apple banana citrus date elk fire garlic hotdog iris".split(" ")})},disableToolButtonBorder=function(){$(".tool-button").on("focus",function(){$(this).blur()})},handlebarCompile=memoize(function(a){return Handlebars.compile(a)}),handlebarBuild=memoize(function(a,c){return a(c)}),handlebarExec=function(a,c,b){if("object"!==
typeof b)throw Error("Context passed to handlebar must be an object");if("string"!==typeof a||"string"!==typeof c)throw Error("Selectors must be strings");a=$(a);c=$(c);if(0===a.length||0===c.length)throw Error("Script or target does not exist");a=a.html();a=handlebarCompile(a);b=handlebarBuild(a,b);c.html()!==b&&c.html(b)},flashDupes=function(a,c){var b=c.siblings().filter(function(c,b){var f=b.innerHTML;if(f in a)return a.hasOwnProperty(f)});flashSelectionRed(b)},flashSelectionRed=function(a){a.addClass("redBackground");
window.setTimeout(function(){a.removeClass("redBackground").addClass("defaultBackground")},1E3)},moveCaretToStart=function(a){if(a instanceof Node&&window.getSelection&&document.createRange){var c=document.createRange();c.selectNodeContents(a);c.collapse(!0);a=window.getSelection();a.removeAllRanges();a.addRange(c)}else c=a.innerHTML,a.innerHTML="",a.innerHTML=c},initCustomScrollbars=function(){$(window).load(function(){$("#column-container-wrapper").mCustomScrollbar({axis:"y"});$("#util-bar").mCustomScrollbar({axis:"y"})})};function countLetterFrequency(a,c){if("string"!==typeof a)throw new TypeError("Not a string!");if(null===c||"object"!==typeof c)throw new TypeError("Not an object!");for(var b=a.toUpperCase(),d=0,e=b.length;d<e;d++)b[d]in c&&c[b[d]]++}function getTextLetterFrequencySwe(a){var c={A:0,B:0,C:0,D:0,E:0,F:0,G:0,H:0,I:0,J:0,K:0,L:0,M:0,N:0,O:0,P:0,Q:0,R:0,S:0,T:0,U:0,V:0,W:0,X:0,Y:0,Z:0,"\u00c5":0,"\u00c4":0,"\u00d6":0};a&&countLetterFrequency(a,c);return c}
function getTextLetterFrequencyEng(a){var c={A:0,B:0,C:0,D:0,E:0,F:0,G:0,H:0,I:0,J:0,K:0,L:0,M:0,N:0,O:0,P:0,Q:0,R:0,S:0,T:0,U:0,V:0,W:0,X:0,Y:0,Z:0};a&&countLetterFrequency(a,c);return c};function initHomeMngr(){document.body.addEventListener("fileChange",function(a){var c=$("#home-text-area");$("#home-no-file").hide();c.html(a.detail);c.show()})};var caesarLookUp=function(a,c,b){if("string"!==typeof a||"string"!==typeof c||"string"!==typeof b)throw new TypeError("Argument is not a string");if(""===a||""===c||""===b)throw Error("Argument is empty string");var d=b.indexOf(a);if(-1===d)return console.log("vig:Cryptoletter not in alphabet"),"?";c=b.indexOf(c);if(-1===c)throw Error("Key is not in the alphabet");a=b.indexOf(a,c);return b[-1===a?b.length-c+d:a-c]},caesarReverseLookUp=function(a,c,b){a=b.indexOf(a);c=b.indexOf(c);return b[(a+c)%b.length]},
decipherVigenereString=function(a,c,b){if("string"!==typeof a||"string"!==typeof c||"string"!==typeof b)throw new TypeError("Argument is not a string");var d=c.length,e=a.length,f="";b=getAlphabet(b);for(var g=0;g<e;g++)f+=caesarLookUp(a[g],c[g%d],b);return f},encryptVigenere=function(a,c,b){for(var d=0,e=c.length,f=a.length,g="",h=0;h<f;h++)g+=caesarReverseLookUp(a[h],c[d],b),d=(d+1)%e;return g},vigLetterGraph=function(a,c,b,d){if("number"!==typeof a||0>a||a>=c)throw Error("I cannot let you do that, Dave");
if(!d||"object"!==typeof d)throw Error("alphaObj must be an object");for(var e="";a<b.length;a+=c)e+=b[a];countLetterFrequency(e,d);return{name:"Vigenere offset alphabet",data:getValuesFromObject(d)}},shiftArray=function(a,c){if("number"!==typeof c||"object"!==typeof a)throw Error("shiftArray: invalid parameters");for(var b=[],d=0;d<a.length;++d)b.push(a[(d+c+a.length)%a.length]);return b};function handlebarAlphabetDivs(a){if("object"!==typeof a)throw Error("alphabet must be an object");var c={letters:[]},b;for(b in a)a.hasOwnProperty(b)&&c.letters.push(b.toUpperCase());handlebarExec("#orig-alphabet-hbs","#plain-cryptobet .normal-alphabet",c);handlebarExec("#orig-alphabet-hbs","#crypto-plainbet .normal-alphabet",c)}
function handlebarCryptobetDivs(a){if("object"!==typeof a)throw Error("alphabet must be an object");var c={letters:[]},b;for(b in a)a.hasOwnProperty(b)&&c.letters.push("");handlebarExec("#crypto-alphabet-hbs","#crypto-alphabet",c);handlebarExec("#crypto-alphabet-hbs","#plain-alphabet",c)}
function handlebarMessageDivs(a,c){if("undefined"==typeof a.length||"undefined"==typeof a.substr)throw Error("a message needs a length");if("object"!==typeof c)throw Error("alphabet must be an object");for(var b=Math.ceil(a.length/40),d={row:[]},e=0;e<b;++e){var f="PLACEHOLDER";a&&(f=a.substr(40*e,40));d.row.push({encrypted:f,decrypted:decryptLine(f,c)})}handlebarExec("#message-divs-hbs","#message-divs",d)};var utilState=utilState||{};function initViewMngr(){initUtilState();initUtilDrag()}function initUtilState(){var a=[];$("#util-tools").children(".graph-container").each(function(){a.push(this)});$("#cipher-tool").children().each(function(){utilState[this.id]={order:a,openTools:{}}});utilState.HOME="home-view";utilState.activeView=utilState.HOME}
function initUtilDrag(){dragula([document.querySelector(".graph-area")],{revertOnSpill:!0,direction:"vertical",moves:function(a,c,b){return b.classList.contains("graph-container-header")}}).on("drop",function(){saveUtilOrder()})}
function viewChange(a,c){var b=a!==utilState.activeView;a==utilState.HOME?$(".tool-button").removeClass("tool-button-active"):($(".tool-button").not(this).removeClass("tool-button-active"),$(c).addClass("tool-button-active"));$("#cipher-tool").children().each(function(){this.id!==a?$(this).hide():($(this).show(),utilState.activeView=this.id,$(this).trigger("viewChange"))});b&&loadUtilState()}
function expandCollapseGraph(a){a=$(a).parent();var c=a.attr("id");if(!a.children("graph-container-content").is(":animated")){var b=utilState[utilState.activeView].openTools[c];utilState[utilState.activeView].openTools[c]=!b;setVisibilityOf(a,!b);window.dispatchEvent(new Event("resize"))}}
function setVisibilityOf(a,c){a=$(a);var b=a.children(".graph-container-content"),d=a.children(".graph-container-header").children(0);$(d).removeClass();$(d).addClass("arrow");$(d).addClass(c?"arrow-down":"arrow-right");c?$(b).stop().slideDown(200):$(b).stop().slideUp(200)}function saveUtilOrder(){var a=[];$("#util-tools").children(".graph-container").each(function(){a.push(this)});utilState[utilState.activeView].order=a}
function loadUtilState(){var a=function(){for(var a=utilState[utilState.activeView].order,d=0;d<a.length-1;d++)$(a[d+1]).insertAfter(a[d]);setTimeout(c,200)},c=function(){$("#util-tools").children(".graph-container").each(function(){utilState[utilState.activeView].openTools[this.id]&&setVisibilityOf(this,!0)});window.dispatchEvent(new Event("resize"))};(function(){$("#util-tools").children(".graph-container").each(function(){setVisibilityOf(this,!1)});setTimeout(a,200)})()};function updateBigramFactorTable(a){handlebarExec("#bigram-factor-table-template","#bigram-factor-table",{bigram:getBigramFactors(a)})}function initBigramFactorMngr(){document.body.addEventListener("fileChange",function(a){updateBigramFactorTable(a.detail)})};function AppState(a,c){var b=a,d=c,e="",f={};this.getLang=function(){return b};this.getFileName=function(){return d};this.getFileText=function(){return e};this.fileIsSelected=function(){return void 0!==d};this.applySettings=function(a){var c=$("#lang-select"),e=$("#file-select"),f,g;"lang"===a?(f=appState.getLang(),g=c):"file"===a&&(f=appState.getFileName(),g=e);g.val()!==f?(g.addClass("changed-setting"),g.children().each(function(){$(this).val()===f&&$(this).addClass("last-setting")})):(g.removeClass("changed-setting"),
$("option:selected",g).removeClass("last-setting"));c.hasClass("changed-setting")&&(b=c.val(),k());e.hasClass("changed-setting")&&(d=e.val(),h());clearSettingIndications();$("#apply-button").prop("disabled",!0)};var g=function(a){return(a=f[a])?a:null},h=function(){var a=g(d);a?(e=a,a=new CustomEvent("fileChange",{detail:e}),document.body.dispatchEvent(a)):$.ajax({url:appConfig.CRYPTO_TEXT_PATH+"/"+d,dataType:"text",success:function(a){e=a=a&&a.toUpperCase();f[d]||(f[d]=e);a=new CustomEvent("fileChange",
{detail:a});document.body.dispatchEvent(a)},error:function(){alert("Failed to get file.");console.log("AJAX-call to get text file failed.")}})},k=function(){var a=new CustomEvent("languageChange",{detail:b});document.body.dispatchEvent(a)}}var appState;function initAppState(){appState=new AppState($("#lang-select").val(),$("#file-select").val())}
function clearSettingIndications(){var a=$("#lang-select"),c=$("#file-select");a.removeClass("changed-setting");c.removeClass("changed-setting");a.children("option").removeClass("last-setting");c.children("option").removeClass("last-setting")};function getNGramCount(a,c,b){if("string"!==typeof a)throw TypeError("text must be a string");if("number"!==typeof c)throw TypeError("n must be a number");if(1>c)throw RangeError("n must be greater than or equal to one");if("number"!==typeof b)throw TypeError("count must be a number");if(0>b)throw RangeError("count must be non-negative");a=a.toUpperCase();for(var d={},e="",f=0;f<=a.length-c;f++)e=a.slice(f,f+c),d[e]=d[e]?d[e]+1:1;a=[];for(e in d)d.hasOwnProperty(e)&&a.push({ngram:e,num:d[e]});a.sort(function(a,
c){return c.num-a.num});return a.slice(0,b)}function createEmptyContext(a){for(var c=[],b=0;b<a;b++)c.push({ngram:"-",num:"-"});return c};function getBigramDistances(a,c){for(var b=[],d=a.indexOf(c);-1!==d;){for(var e=0;e=a.indexOf(c,e+d+1),-1!==e;)b.push(e-d);d=a.indexOf(c,d+1)}return b}function getBigramFactors(a){for(var c=getNGramCount(a,2,50),b=[{nr:2,count:0},{nr:3,count:0},{nr:4,count:0},{nr:5,count:0},{nr:6,count:0},{nr:7,count:0},{nr:8,count:0}],d=0;d<c.length;d++)for(var e=getBigramDistances(a,c[d].ngram),f=2;f<b.length+2;f++)for(var g=0;g<e.length;g++)0===e[g]%f&&(b[f-2].count+=1);return b};function memoize(a){var c={};return function(){var b=String(Hashcode.value(JSON.stringify(arguments))>>>0);return c[b]=c[b]||a.apply(this,arguments)}}function getValuesFromObject(a){if(null===a||"object"!==typeof a)throw new TypeError("Not an object!");var c=[],b;for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(a[b]);return c}
var getAlphabet=function(a){if("en"===a)return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";if("sv"===a)return"ABCDEFGHIJKLMNOPQRSTUVWXYZ\u00c5\u00c4\u00d6";if("string"!==typeof a)throw new TypeError("Argument is not a string");throw Error("Language not recognized");};
jQuery.fn.keyboardEvents=function(a,c){var b={backspace:8,del:46,newline:13,tab:9,right:39,left:37,up:38,down:40};if("function"!==typeof c)throw Error("keyboardEvents expects callback to be a function");if("number"!==typeof a.length)throw Error("keyboardEvents expects keys to have a length property");"string"===typeof a&&(a=a.toLowerCase().split(" "));for(var d={},e=0;e<a.length;++e){var f=b[a[e]];f&&(d[f]=!0)}return this.on("keydown",function(a){var b=a.currentTarget;return a.keyCode in d?(jQuery.proxy(c,
b)(),!1):!0})};function buildList(a,c){for(var b=[],d=0;d<c;d++)b.push(a);return b}function calculateColumns(a,c){if("string"!==typeof c)throw new TypeError("text not a string");if("number"!==typeof a)throw new TypeError("nCols not a number");if(0>=a)throw new RangeError("nCols smaller than 1");for(var b=buildList("",a),d=0;d<c.length;d++)b[d%a]+=c[d];return b}function decryptTransposition(a,c,b){for(var d=calculateColumns(a,b),e="",f,g=0;g<b.length+a;g++)f=c[g%a],f=d[f][Math.floor(g/a)],e+=f?f:"";return e}
function padText(a,c){var b=c;if(0!==c.length%a)for(var d=0;d<a-c.length%a;d++)b+=" ";return b}function getHandlebarsColumns(a,c){for(var b={column:[]},d=calculateColumns(a,c),e=0;e<a;e++)b.column.push({number:e+1,letters:d[e].split("")});return b};$(function(){initAppState();initInterface();initBigramFactorMngr();initNGramTablesMngr();initStatChartsMngr();initHomeMngr();initViewMngr();initSubstMngr();initTransMngr();initVigMngr();initAbout()});var nCols=4;function updateResultText(){for(var a=document.querySelectorAll("#column-container > .trans-column"),c=[],b,d=0;d<a.length;d++)b=parseInt(a[d].getAttribute("data-index"))-1,c.push(b);a=decryptTransposition(nCols,c,appState.getFileText());$("#trans-result").html(a)}function columnIncrDecr(a){appState.fileIsSelected()&&(nCols+=a,9<nCols?nCols=9:2>nCols?nCols=2:generateNewColumns())}
function resetTransTool(){if(appState.fileIsSelected()){nCols=4;var a=getHandlebarsColumns(nCols,padText(nCols,appState.getFileText())),c=handlebarCompile($("#trans-col-template").html()),a=handlebarBuild(c,a);$("#column-container").html(a);updateResultText()}}
function orderColumns(a,c){var b=[];a.each(function(a,e){var f=$(e).attr("data-index"),g=c.filter(function(a,c){return $(c).attr("data-index")==f});0<g.length&&b.push(g.get(0))});b.length&&c.length>b.length&&b.push(c.last().get(0));return b}
function generateNewColumns(){var a=padText(nCols,appState.getFileText()),a=getHandlebarsColumns(nCols,a),c=$("#trans-col-template").html(),c=handlebarCompile(c),c=handlebarBuild(c,a),a=$("#column-container"),b=$("<div></div>").html(c),d=a.children(),b=b.children(),c=0<d.length?orderColumns(d,b):c;a.html(c);updateResultText()}
function initTransMngr(){document.body.addEventListener("fileChange",function(a){$("#trans-result").html("");generateNewColumns()});dragula([document.querySelector("#column-container")],{revertOnSpill:!1,direction:"horizontal"}).on("drop",function(){updateResultText()})};var initVigMngr=function(){document.body.addEventListener("fileChange",function(a){resetVigenere()});document.body.addEventListener("languageChange",resetVigenere);resetVigenere();$("#vig-tool").one("viewChange",function(){window.dispatchEvent(new Event("resize"))})},resetVigenere=function(){handlebarVigenereKey(3,{resetKey:!0});vigenereSetupInputCallbacks();updateVigenereText();redrawFixedGraph();recalculateShiftedGraph();$(".vig-shift-button").addClass("blur-active")},vigenereSetupInputCallbacks=
function(){var a=$(".vigenere-key");a.on("keypress",function(){moveCaretToStart(this)});a.keyboardEvents("right",function(){$(this).next().focus()});a.keyboardEvents("left",function(){$(this).prev().focus()});a.on("input",function(){var a=$(this),b=a.html(),d=$("#lang-select").val();b.match(getRegexForLang(d))?a.html(b.charAt(0).toUpperCase()):(console.log("vig: illegal char entered"),a.html(""));updateVigenereText();recalculateShiftedGraph(this)});a.on("focus",function(){$(this).siblings().removeClass("vig-active-letter");
$(this).addClass("vig-active-letter");recalculateShiftedGraph(this)});$("#vig-buttons").children("button").on("click",function(){$(this).hasClass("button-plus")?vigKeyLenAdjust(1):vigKeyLenAdjust(-1);recalculateShiftedGraph(this)});$(".vig-left-shift-button").off("click").on("click",function(){$(this).hasClass("blur-active")||(vigShift(1),recalculateShiftedGraph(),updateVigenereText())});$(".vig-right-shift-button").off("click").on("click",function(){$(this).hasClass("blur-active")||(vigShift(-1),
recalculateShiftedGraph(),updateVigenereText())})},vigShift=function(a){var c=$(".vig-active-letter").get(0);if(c){var b=$("#lang-select").val(),b=getAlphabet(b),d=b.indexOf(c.innerHTML);-1===d?console.log("active letter not in alphabet"):c.innerHTML=b[(d+a+b.length)%b.length]}},recalculateShiftedGraph=function(a){if((a=a||$(".vig-active-letter").get(0))&&a.innerHTML){var c=a.innerHTML,b=$("#lang-select").val(),b=getAlphabet(b),c=b.indexOf(c),c=(b.length+c)%b.length;a=parseInt(a.getAttribute("data-key-index"));
a=redrawShiftableGraph(a,c)}else a=redrawShiftableGraph(0,0);a?$(".vig-shift-button").removeClass("blur-active"):$(".vig-shift-button").addClass("blur-active")},vigKeyLenAdjust=function(a){a=$(".vigenere-key").length+a;2<=a&&8>=a&&handlebarVigenereKey(a);vigenereSetupInputCallbacks();updateVigenereText()},updateVigenereText=function(){var a=getVigKey(),c=appState.getLang(),b=appState.getFileText();$("#vig-result").text(decipherVigenereString(b,a,c))},getVigKey=function(){var a="";$(".vigenere-key").each(function(){a+=
$(this).text()||"A"});return a};var redrawFixedGraph=function(){var a=$("#lang-select").val();"sv"===a?plotGraph("#vig-fixed-graph",swedishGraphData,"Swedish letter statistics","column",Object.keys(swedishStats),"Frequency (%)",!0):"en"===a&&plotGraph("#vig-fixed-graph",englishGraphData,"English letter statistics","column",Object.keys(englishStats),"Frequency (%)",!0)},redrawShiftableGraph=function(a,c){var b=appState.getLang(),d=appState.getFileText();if(appState.fileIsSelected()){if($(".vig-active-letter").get(0)){var e=getVigKey(),
b=initAlphabet(b),f;for(f in b)b.hasOwnProperty(f)&&(b[f]=0);d=vigLetterGraph(a,e.length,d,b);d.data=shiftArray(d.data,c);d.color=bar_color;e=shiftArray(Object.keys(b),c);plotGraph("#vig-movable-graph",d,"Letters shifted by selected key letter","column",e,"Occurrences",!1);return!0}plotGraph("#vig-movable-graph",initAlphabet(b),"Please select a key letter","column",{},"",!1,"Please select a key letter")}else plotGraph("#vig-movable-graph",initAlphabet(b),"Please choose a file","column",{},"",!1,"No file loaded")},
handlebarVigenereKey=function(a,c){if("number"!==typeof a)throw Error("keyLength must be an number");for(var b={keyLetter:[]},d=0;d<a;++d)b.keyLetter.push("A");c=c||{};d=$("#vigenere-key-hbs").html();d=handlebarCompile(d);b=handlebarBuild(d,b);d=$("#vig-key");if(!c.resetKey){var e=$("<div></div>");e.html(b);var f=d.children();e.children().each(function(a,c){var b=f.get(a);b&&($(c).html(b.innerHTML),$(c).addClass(b.className))});b=e.html()}d.html(b)};(function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var d=document.createEvent("CustomEvent");d.initCustomEvent(a,b.bubbles,b.cancelable,b.detail);return d}if("function"===typeof window.CustomEvent)return!1;a.prototype=window.Event.prototype;window.CustomEvent=a})();function initAlphabet(a){if(!Array.prototype.reduce)throw Error("Browser does not have array.reduce");return getAlphabet(a).toUpperCase().split("").reduce(function(a,b){a[b]="_";return a},{})}
function decryptLine(a,c){if("object"!==typeof c)throw Error("cannot decrypt without a substitution alphabet object");if("undefined"==typeof a.length||"function"!=typeof a.charAt)throw Error("cannot decrypt lines that does not have a length or index");for(var b="",d=0,e=a.length;d<e;d++)var f=a.charAt(d),b=b+(c[f]||"_");return b}function objectSize(a){var c=0;if("object"!==typeof a)throw Error("objectSize does not like non-objects as parameters");for(var b in a)a.hasOwnProperty(b)&&++c;return c}
function getDuplicates(a){if(!a||"undefined"==typeof a.length)throw Error("Array must have a defined length");for(var c={},b=0,d=a.length;b<d;++b){var e=a[b];e&&(c[e]=c[e]?c[e]+1:1)}a={};for(var f in c)c.hasOwnProperty(f)&&1<c[f]&&(a[f]=c[f]);return a}function getRegexForLang(a){var c=/^[a-z]+$/i,b=/^[a-z\u00e5\u00e4\u00f6]+$/i;if("sv"===a)return b;if("en"===a)return c;throw Error("Lang not 'en' or 'sv'");}
function invertObject(a){if("object"!==typeof a)throw Error("can't invert non-objects");var c={},b;for(b in a)a.hasOwnProperty(b)&&(c[a[b]]=b);return c}jQuery.fn.toInnerHTMLArray=function(){var a=[];this.each(function(c,b){a.push(b.innerHTML.trim(""))});return a};jQuery.fn.isEmpty=function(){return""==jQuery.trim(this.html())};var chart_font=window.getComputedStyle(document.querySelector("html")).getPropertyValue("--chartFont"),bar_color=window.getComputedStyle(document.querySelector("html")).getPropertyValue("--bar-color"),swedishStats={A:9.383,B:1.535,C:1.486,D:4.702,E:10.149,F:2.027,G:2.862,H:2.09,I:5.817,J:.614,K:3.14,L:5.275,M:3.471,N:8.542,O:4.482,P:1.839,Q:.02,R:8.431,S:6.59,T:7.691,U:1.919,V:2.415,W:.142,X:.159,Y:.708,Z:.07,"\u00c5":1.338,"\u00c4":1.797,"\u00d6":1.305},englishStats={A:8.167,B:1.492,C:2.782,D:4.253,
E:12.702,F:2.228,G:2.015,H:6.094,I:6.966,J:.153,K:.772,L:4.025,M:2.406,N:6.749,O:7.507,P:1.929,Q:.095,R:5.987,S:6.327,T:9.056,U:2.758,V:.978,W:2.36,X:.15,Y:1.974,Z:.074};try{var swedishGraphData={name:"Swedish",data:getValuesFromObject(swedishStats),font:chart_font,color:bar_color},englishGraphData={name:"English",data:getValuesFromObject(englishStats),font:chart_font,color:bar_color}}catch(a){a instanceof TypeError&&console.log("Invalid stats parameter when calling getValuesFromObject:"+a.message)}
var cryptoGraphData={name:"",data:[],color:bar_color,font:chart_font},plotGraph=function(a,c,b,d,e,f,g,h,k){k=k||function(){return this.x+": <b>"+this.y+"</b>"};h=h||"No data available";$(a).highcharts({chart:{type:d,style:{fontFamily:chart_font,fontSize:"12px"}},title:{text:b,style:{fontFamily:chart_font,fontSize:"14px"}},xAxis:{categories:e,labels:{step:1}},yAxis:{title:{text:f},tickInterval:3,min:0},legend:{enabled:!1},tooltip:{formatter:k},plotOptions:{series:{pointPadding:0,groupPadding:.1,borderWidth:0,
shadow:!1,animation:g}},lang:{noData:h},credits:!1,series:[c]})},setCryptoGraphData=function(a,c){"sv"===a?cryptoGraphData.name="Swedish":"en"===a&&(cryptoGraphData.name="English");if(appState.getFileText())try{cryptoGraphData.data=getValuesFromObject(c)}catch(b){b instanceof TypeError&&console.log("Invalid parameter stats: "+b.message)}else cryptoGraphData.data=[]},plotGraphs=function(a){var c,b=appState.getFileText();"sv"===a?(plotGraph("#language-stats-area",swedishGraphData,"Swedish letter statistics",
"column",Object.keys(swedishStats),"Frequency (%)",!0),appState.fileIsSelected()&&(c=getTextLetterFrequencySwe(b))):"en"===a&&(plotGraph("#language-stats-area",englishGraphData,"English letter statistics","column",Object.keys(englishStats),"Frequency (%)",!0),appState.fileIsSelected()&&(c=getTextLetterFrequencyEng(b)));b="";setCryptoGraphData(a,c);appState.fileIsSelected()&&(b=Object.keys(c));plotGraph("#crypto-stats-area",cryptoGraphData,"Loaded text letter statistics","column",b,"Occurrences",!0,
"No file loaded")},initStatChartsMngr=function(){document.body.addEventListener("languageChange",function(a){plotGraphs(appState.getLang())});document.body.addEventListener("fileChange",function(a){plotGraphs(appState.getLang())});plotGraphs(appState.getLang())};function initAbout(){var a=$("#logo-wrapper"),c=$("#about-close-button"),b=$("#about-overlay"),d=function(a){!b.is(":visible")||$(a.target).closest("#about-overlay").length||$(a.target).is("#about-button")||(b.hide(),$(document).unbind("click",d))};a.click(function(){b.show()});c.click(function(){b.hide();$(document).unbind("click",d)});$(document).keyup(function(a){27===a.keyCode&&(b.hide(),$(document).unbind("click",d))})};var appConfig=appConfig||{};appConfig.CRYPTO_TEXT_PATH="res";appConfig.TEXT_FILE_COUNT=8;function initSubstMngr(){substResetTool();document.body.addEventListener("fileChange",function(a){substResetTool("fileChange",a.detail)});document.body.addEventListener("languageChange",function(){substResetTool("resetDecrypted")})}
function setupInputCallbacks(){var a=$(".alphabet-editable").children();a.on("keydown",function(){moveCaretToStart(this)});a.keyboardEvents("backspace del",function(){var a=$(this);a.isEmpty()?a.prev().focus():(a.html(""),updatePartnerSubstBet(this))});a.keyboardEvents("newline right",function(){$(this).next().focus()});a.keyboardEvents("left",function(){$(this).prev().focus()});a.keyboardEvents("up down",function(){var a=this.parentNode,b;"plain-alphabet"===a.id?b=$("#crypto-alphabet"):"crypto-alphabet"===
a.id&&(b=$("#plain-alphabet"));a=$(this).index();b.children().eq(a).focus()});a.on("input",function(){var a=$(this),b=a.html(),d=$("#lang-select").val();b.match(getRegexForLang(d))?0<b.length&&a.html(b.charAt(0).toUpperCase()):(console.log("subst: illegal char entered"),a.html(""));updatePartnerSubstBet(this);return!0})}
function updatePartnerSubstBet(a,c){var b;b=a.parentNode;var d={};"plain-alphabet"===b.id?d=updateSubstAlphabets("#plain-alphabet","#crypto-alphabet"):"crypto-alphabet"===b.id&&(d=updateSubstAlphabets("#crypto-alphabet","#plain-alphabet"),d.val&&(d.val=invertObject(d.val)));b=d;d=$(a);b.dupes?(d.html(""),c||(updatePartnerSubstBet(a,!0),flashDupes(b.dupes,d))):c||1!==d.html().length||d.is(":focus")&&d.next().focus();updateMessageDivs(b.val);return!0}
function updateSubstAlphabets(a,c){var b=$(a).children().toInnerHTMLArray(),d=getDuplicates(b);if(0!=objectSize(d))return{dupes:d};var e=[],f={},d=$(a).siblings(".normal-alphabet").children();d.each(function(a,c){e[a]=c.innerHTML;var d=b[a];d&&(f[d]=c.innerHTML)});var g=$(c).children();g.each(function(a,b){var c=f[e[a]]||"";$(b).html(c)});var h=function(a,b){a.removeClass("transparent-letter").each(function(){-1<b.indexOf(this.innerHTML)&&$(this).addClass("transparent-letter")})},k=$(c).siblings(".normal-alphabet").children(),
g=g.toInnerHTMLArray();h(d,b);h(k,g);return{val:f}}function updateMessageDivs(a){if("object"!==typeof a)return!1;var c=$("#message-divs"),b=$(".decr-msg-row",c),d=$(".encr-msg-row",c).toInnerHTMLArray(),e=0;b.each(function(b,c){var h=decryptLine(d[b],a);h!==c.innerHTML&&(e++,$(c).html(h))});return!0}
function substResetTool(a,c){var b=initAlphabet(appState.getLang());"fileChange"==a&&c&&handlebarMessageDivs(c,b);handlebarAlphabetDivs(b);handlebarCryptobetDivs(b);setupInputCallbacks();"resetDecrypted"==a&&updateMessageDivs(b)}function substDrop(a){var c=a.dataTransfer;c&&a.target&&c.getData?(a.target.innerHTML=c.getData("source"),$(a.target).blur(),$(a.target).trigger("input")):alert("dropping not supported by this browser");a.preventDefault()}
function substDrag(a){var c=a.dataTransfer;c&&a.target&&c.setData?c.setData("source",a.target.innerHTML):(alert("drag-and-drop is not supported on this browser"),a.preventDefault())};
